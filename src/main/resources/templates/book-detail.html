<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="*{name}">Book Details</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-900" th:replace="fragments/layout :: layout (~{::main})">

<main class="container mx-auto px-6 py-12">
    <div th:object="${book}" class="bg-white p-8 rounded-lg shadow-xl max-w-4xl mx-auto">

        <!-- Back Link -->
        <a th:href="@{/books}" class="inline-block text-blue-600 hover:text-blue-800 mb-6" th:text="#{book-detail.back}">
            &larr; Back to Book List
        </a>

        <!-- Book Title and Author -->
        <h1 class="text-4xl font-bold mb-2" th:text="*{name}">Book Title</h1>
        <p class="text-2xl text-gray-600 mb-6"><span th:text="#{book-detail.by}"></span> <span th:text="*{author}">Book Author</span></p>

        <!-- Price -->
        <div class="text-4xl font-light text-blue-700 mb-8">
            $<span th:text="${#numbers.formatDecimal(book.price, 1, 2)}">19.99</span>
        </div>

        <!-- Client Action: Add to Cart -->
        <div sec:authorize="hasRole('CLIENT')" class="mb-8">
            <form th:action="@{/cart/add}" method="post" class="flex items-center space-x-4" th:object="${addToCartDTO}">
                <input type="hidden" name="bookName" th:value="${book.name}" />
                <div>
                    <label for="quantity" class="block text-sm font-medium text-gray-700" th:text="#{book.quantity}">Quantity</label>
                    <input type="number" id="quantity" value="1" th:field="*{quantity}" min="1" class="mt-1 block w-20 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                </div>
                <button type="submit" class="self-end px-8 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75"
                        th:text="#{book-detail.addToCart}">
                    Add to Cart
                </button>
            </form>
        </div>

        <!-- Employee Actions: Edit/Delete -->
        <div sec:authorize="hasRole('EMPLOYEE')" class="mb-8 flex space-x-4">
            <!-- Edit Button -->
            <a th:href="@{/books/{name}/edit(name=*{name})}" class="px-6 py-2 bg-yellow-500 text-white font-semibold rounded-lg shadow-md hover:bg-yellow-600"
               th:text="#{book.edit}">
                Edit Book
            </a>

            <!-- Delete Form (for safe DELETE requests) -->
            <form th:action="@{/books/{name}(name=*{name})}" th:method="delete" onsubmit="return confirm('Are you sure you want to delete this book?');">
                <button type="submit" class="px-6 py-2 bg-red-600 text-white font-semibold rounded-lg shadow-md hover:bg-red-700"
                        th:text="#{book-detail.delete}">
                    Delete Book
                </button>
            </form>
        </div>

        <!-- Book Description -->
        <div class="prose max-w-none mb-8">
            <h2 class="text-2xl font-semibold mb-3" th:text="#{book.description}">Description</h2>
            <p th:text="*{description}">
                Full book description goes here...
            </p>
        </div>

        <!-- Book Details Grid -->
        <div>
            <h3 class="text-2xl font-semibold mb-4 border-b pb-2" th:text="#{details}">Details</h3>
            <dl class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                <div class="col-span-1">
                    <dt class="font-medium text-gray-600" th:text="#{book-detail.genre}">Genre</dt>
                    <dd class="text-lg" th:text="*{genre}">Genre</dd>
                </div>
                <div class="col-span-1">
                    <dt class="font-medium text-gray-600" th:text="#{book.language}">Language</dt>
                    <dd class="text-lg" th:text="#{${'lang.' + book.language}}">Language</dd>
                </div>
                <div class="col-span-1">
                    <dt class="font-medium text-gray-600" th:text="#{book.publicationDate}">Publication Date</dt>
                    <dd class="text-lg" th:text="*{publicationDate}">Publication Date</dd>
                </div>
                <div class="col-span-1">
                    <dt class="font-medium text-gray-600" th:text="#{book.ageGroup}">Age Group</dt>
                    <dd class="text-lg" th:text="#{${'age.' + book.ageGroup}}">Age Group</dd>
                </div>
                <div class="col-span-1">
                    <dt class="font-medium text-gray-600" th:text="#{book.pages}">Pages</dt>
                    <dd class="text-lg" th:text="*{pages}">Pages</dd>
                </div>
                <div class="col-span-1">
                    <dt class="font-medium text-gray-600" th:text="#{book.characteristics}">Characteristics</dt>
                    <dd class="text-lg" th:text="*{characteristics}">Characteristics</dd>
                </div>
            </dl>
        </div>

    </div>
</main>

</body>
</html>

<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <title th:text="${isEdit} ? #{book.edit} : #{book-form.add}"></title>
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-100" th:replace="fragments/layout :: layout (~{::main})">

<main class="container mx-auto max-w-2xl mt-12 mb-12 p-8 bg-white rounded-lg shadow-xl">

    <h1 class="text-3xl font-bold text-gray-800 mb-6"
        th:text="${isEdit} ? #{book.edit} : #{book-form.add}">Add New Book</h1>

    <div th:if="${errorMessage}" class="mb-4 p-3 bg-red-100 text-red-700 rounded-lg">
        <p th:text="${errorMessage}">Error placeholder</p>
    </div>

    <!--
      This is the key logic:
      1. th:action: If 'isEdit' is true, set action to PUT /books/{name}. Otherwise, POST /books.
      2. th:method: If 'isEdit' is true, set method to "put". Otherwise, "post".

      Spring Boot will see th:method="put" and add a hidden _method field
      to convert the browser's POST into a PUT request for the controller.
    -->
    <form th:object="${book}"
          th:action="${isEdit} ? @{/books/{name}(name=${book.name})} : @{/books}"
          th:method="${isEdit} ? 'put' : 'post'"
          method="post"
          class="space-y-6">

        <!-- Name -->
        <div>
            <label for="name" class="block text-sm font-medium text-gray-700" th:text="#{book.name}">Book Name</label>
            <input type="text" id="name" th:field="*{name}"
                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
            <!-- Display Validation Error -->
            <p th:if="${#fields.hasErrors('name')}" th:errors="*{name}"
               class="text-sm text-red-600 mt-1"></p>
        </div>

        <!-- Author -->
        <div>
            <label for="author" class="block text-sm font-medium text-gray-700" th:text="#{book.author}">Author</label>
            <input type="text" id="author" th:field="*{author}"
                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
            <p th:if="${#fields.hasErrors('author')}" th:errors="*{author}"
               class="text-sm text-red-600 mt-1"></p>
        </div>

        <!-- Genre -->
        <div>
            <label for="genre" class="block text-sm font-medium text-gray-700" th:text="#{book.genre}">Genre</label>
            <input type="text" id="genre" th:field="*{genre}"
                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
            <p th:if="${#fields.hasErrors('genre')}" th:errors="*{genre}"
               class="text-sm text-red-600 mt-1"></p>
        </div>

        <!-- Price -->
        <div>
            <label for="price" class="block text-sm font-medium text-gray-700" th:text="#{book.price}">Price</label>
            <input type="number" step="0.01" id="price" th:field="*{price}"
                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
            <p th:if="${#fields.hasErrors('price')}" th:errors="*{price}"
               class="text-sm text-red-600 mt-1"></p>
        </div>

        <!-- Publication Date -->
        <div>
            <label for="publicationDate" class="block text-sm font-medium text-gray-700" th:text="#{book.publicationDate}">Publication Date</label>
            <input type="date" id="publicationDate" th:field="*{publicationDate}"
                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
            <p th:if="${#fields.hasErrors('publicationDate')}" th:errors="*{publicationDate}"
               class="text-sm text-red-600 mt-1"></p>
        </div>

        <!-- Pages -->
        <div>
            <label for="pages" class="block text-sm font-medium text-gray-700" th:text="#{book.pages}">Pages</label>
            <input type="number" id="pages" th:field="*{pages}"
                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
            <p th:if="${#fields.hasErrors('pages')}" th:errors="*{pages}"
               class="text-sm text-red-600 mt-1"></p>
        </div>

        <!-- Language -->
        <div>
            <label for="language" class="block text-sm font-medium text-gray-700" th:text="#{book.language}">Language</label>
            <select id="language" th:field="*{language}"
                    class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                <option th:each="lang : ${T(com.epam.rd.autocode.spring.project.model.enums.Language).values()}"
                        th:value="${lang}" th:text="#{${'lang.' + lang}}">ENGLISH</option>
            </select>
            <p th:if="${#fields.hasErrors('language')}" th:errors="*{language}"
               class="text-sm text-red-600 mt-1"></p>
        </div>

        <!-- Age Group -->
        <div>
            <label for="ageGroup" class="block text-sm font-medium text-gray-700" th:text="#{book.ageGroup}">Age Group</label>
            <select id="ageGroup" th:field="*{ageGroup}"
                    class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                <option th:each="group : ${T(com.epam.rd.autocode.spring.project.model.enums.AgeGroup).values()}"
                        th:value="${group}" th:text="#{${'age.' + group}}">ADULT</option>
            </select>
            <p th:if="${#fields.hasErrors('ageGroup')}" th:errors="*{ageGroup}"
               class="text-sm text-red-600 mt-1"></p>
        </div>

        <!-- Characteristics -->
        <div>
            <label for="characteristics" class="block text-sm font-medium text-gray-700" th:text="#{book.characteristics}">Characteristics</label>
            <input type="text" id="characteristics" th:field="*{characteristics}"
                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
            <p th:if="${#fields.hasErrors('characteristics')}" th:errors="*{characteristics}"
               class="text-sm text-red-600 mt-1"></p>
        </div>

        <!-- Description -->
        <div>
            <label for="description" class="block text-sm font-medium text-gray-700" th:text="#{book.description}">Description</label>
            <textarea id="description" th:field="*{description}" rows="4"
                      class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"></textarea>
            <p th:if="${#fields.hasErrors('description')}" th:errors="*{description}"
               class="text-sm text-red-600 mt-1"></p>
        </div>


        <!-- Submit Button -->
        <div class="flex justify-end space-x-4">
            <a href="/books"
               class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300" th:text="#{btn.cancel}">Cancel</a>
            <button type="submit"
                    th:text="${isEdit} ? #{book.update} : #{book.create}"
                    class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Save
            </button>
        </div>

    </form>
</main>

</body>
</html>
